---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true
    commands:
      - npm ci

  - name: test
    image: node:12
    commands:
      - npm test

  #- name: check-coverage
  #  image: node:12
  #  commands:
  #    - npm run coverage

  - name: build
    image: node:12
    commands:
      - npm run build
      - NPM_CONFIG_IGNORE_SCRIPTS=true npm ci --production

  - name: static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: OUz8NCLCaa65Vrr7a8qz+koByWLTAW1/RFERwhrcnANlgw/cfWG5J2nTznnkEN0FAJkHCSwzyjvyyIvoHtrrqA==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: 2bdc2f916a4e1fc5c17b3ecf0e02fafabc7b498d50ee907289dd307613436ab8

...
